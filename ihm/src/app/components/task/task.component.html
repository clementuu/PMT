@if (task) {
    <div class="card-container task-detail">
        @if (!isEditing) {
            <div class="flex">
                <h2>{{ task.nom }}</h2>
                <div class="flex">
                    <button class="btn btn-secondary me-1" type="button" (click)="startEditing()"><i class="bi bi-pencil-square"></i> Modifier</button>
                    <button class="btn btn-danger" type="button" title="supprimer" (click)="deleteTask()"><i class="bi bi-trash"></i></button>
                </div>
            </div>
            <p><strong>Description:</strong> {{ task.description }}</p>
            <p><strong>Statut:</strong> {{ getStatusDisplayName(task.status) }}</p>
            <p><strong>Priorité:</strong> {{ getPriorityDisplayName(task.priorite) }}</p>
            <p><strong>Date d'échéance:</strong> {{ task.dateEcheance | date:'dd/MM/yyyy' }}</p>
            <p><strong>Date de fin:</strong> {{ task.dateFin | date:'dd/MM/yyyy' }}</p>
            <div class="text-center mt-3">
                <button type="button" class="btn btn-primary" [routerLink]="['/project', task.projectId]">Retour au projet</button>
            </div>
        } @else {
            <form [formGroup]="taskForm" (ngSubmit)="updateTask()">
                <div class="form-group">
                    <label for="nom">Nom</label>
                    <input id="nom" type="text" formControlName="nom" class="form-control">
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" formControlName="description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="dateEcheance">Date d'échéance</label>
                    <input id="dateEcheance" type="date" formControlName="dateEcheance" class="form-control">
                </div>
                <div class="form-group">
                    <label for="priorite">Priorité</label>
                    <select id="priorite" formControlName="priorite" class="form-control">
                        @for (p of priorities; track p) {
                            <option [value]="p">{{ getPriorityDisplayName(p) }}</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label for="status">Statut</label>
                    <select id="status" formControlName="status" class="form-control">
                        @for (s of statuses; track s) {
                            <option [value]="s">{{ getStatusDisplayName(s) }}</option>
                        }
                    </select>
                </div>
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-secondary me-1" (click)="cancelEdit()">Annuler</button>
                    <button type="submit" class="btn btn-primary" [disabled]="taskForm.invalid">Enregistrer</button>
                </div>
            </form>
        }
        @if (task.id) {
            <app-task-assign [taskId]="task.id" [projectId]="task.projectId" (taskAssigned)="onTaskAssigned()"></app-task-assign>
            <app-historique [taskId]="task.id"></app-historique>
        }
    </div>
} @else {
    <p>Chargement de la tâche...</p>
}